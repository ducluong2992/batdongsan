@model IEnumerable<bds.Models.Project>
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success text-center fw-semibold shadow-sm rounded-pill" role="alert">
        @TempData["SuccessMessage"]
    </div>
}
@{
    ViewData["Title"] = "Quản lý dự án của tôi";
    var approved = Model.Where(p => p.Status == "Đã duyệt").ToList();
    var pending = Model.Where(p => p.Status == "Chờ duyệt").ToList();
    var rejected = Model.Where(p => p.Status == "Bị từ chối").ToList();
}

<div class="container mt-4">
    <h2 class="mb-3 text-center text-primary fw-bold">Quản lý dự án của tôi</h2>

    <!-- NAV TABS -->
    <ul class="nav nav-tabs justify-content-center fw-semibold" id="projectTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button" role="tab">
                ✅ Đã duyệt <span class="badge bg-success ms-1">@approved.Count</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab">
                ⏳ Chờ duyệt <span class="badge bg-warning text-dark ms-1">@pending.Count</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="rejected-tab" data-bs-toggle="tab" data-bs-target="#rejected" type="button" role="tab">
                ❌ Bị từ chối <span class="badge bg-danger ms-1">@rejected.Count</span>
            </button>
        </li>
    </ul>

    <!-- TAB CONTENT -->
    <div class="tab-content mt-3" id="projectTabsContent">

        <!-- ĐÃ DUYỆT -->
        <div class="tab-pane fade show active" id="approved" role="tabpanel">
            @if (!approved.Any())
            {
                <p class="text-muted text-center mt-3">Bạn chưa có dự án nào được duyệt.</p>
            }
            else
            {
                <table class="table table-hover align-middle text-center">
                    <thead class="table-light">
                        <tr>
                            <th>Ảnh</th>
                            <th>Tên dự án</th>
                            <th>Địa điểm</th>
                            <th>Ngày đăng</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var project in approved)
                        {
                            <tr style="cursor:pointer;" onclick="window.location.href='@Url.Action("MyProjectDetails", "Project", new { id = project.ProjectID })'">
                                <td>
                                    <img src="@(project.Images?.FirstOrDefault()?.ImageUrl ?? "/images/no-image.png")" width="100" class="rounded shadow-sm" />
                                </td>
                                <td>@project.ProjectName</td>
                                <td>@project.CommuneWard?.CommuneName, @project.CommuneWard?.District?.DistrictName</td>
                                <td>@project.CreateAt.ToString("dd/MM/yyyy HH:mm")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>

        <!-- CHỜ DUYỆT -->
        <div class="tab-pane fade" id="pending" role="tabpanel">
            @if (!pending.Any())
            {
                <p class="text-muted text-center mt-3">Hiện bạn chưa có dự án nào đang chờ duyệt.</p>
            }
            else
            {
                <table class="table table-hover align-middle text-center">
                    <thead class="table-light">
                        <tr>
                            <th>Ảnh</th>
                            <th>Tên dự án</th>
                            <th>Địa điểm</th>
                            <th>Ngày đăng</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var project in pending)
                        {
                            <tr style="cursor:pointer;" onclick="window.location.href='@Url.Action("MyProjectDetails", "Project", new { id = project.ProjectID })'">
                                <td><img src="@(project.Images?.FirstOrDefault()?.ImageUrl ?? "/images/no-image.png")" width="100" class="rounded shadow-sm" /></td>
                                <td>@project.ProjectName</td>
                                <td>@project.CommuneWard?.CommuneName, @project.CommuneWard?.District?.DistrictName</td>
                                <td>@project.CreateAt.ToString("dd/MM/yyyy HH:mm")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>

        <!-- BỊ TỪ CHỐI -->
        <div class="tab-pane fade" id="rejected" role="tabpanel">
            @if (!rejected.Any())
            {
                <p class="text-muted text-center mt-3">Không có dự án nào bị từ chối.</p>
            }
            else
            {
                <table class="table table-hover align-middle text-center">
                    <thead class="table-light">
                        <tr>
                            <th>Ảnh</th>
                            <th>Tên dự án</th>
                            <th>Địa điểm</th>
                            <th>Lý do từ chối</th>
                            <th>Ngày đăng</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var project in rejected)
                        {
                            <tr style="cursor:pointer;" onclick="window.location.href='@Url.Action("MyProjectDetails", "Project", new { id = project.ProjectID })'">
                                <td><img src="@(project.Images?.FirstOrDefault()?.ImageUrl ?? "/images/no-image.png")" width="100" class="rounded shadow-sm" /></td>
                                <td>@project.ProjectName</td>
                                <td>@project.CommuneWard?.CommuneName, @project.CommuneWard?.District?.DistrictName</td>
                                <td class="text-danger fw-semibold">@project.RejectReason</td>
                                <td>@project.CreateAt.ToString("dd/MM/yyyy HH:mm")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>
    </div>
</div>

<style>
    .nav-tabs .nav-link.active {
        font-weight: bold;
        background-color: #0d6efd;
        color: #fff;
    }

    tr:hover {
        background-color: #f0f8ff !important;
    }
</style>
@section Scripts {
    <script>
        // Kiểm tra xem thông báo có tồn tại hay không
        var successAlert = document.getElementById('success-alert');
        if (successAlert) {
            // Thiết lập thời gian chờ (delay) là 5000 mili giây (5 giây)
            setTimeout(function() {
                // Xóa hoàn toàn phần tử khỏi DOM
                successAlert.remove();

            }, 5000); 5 giây
        }
    </script>
}