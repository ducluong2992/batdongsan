@model bds.Models.Post
@{
    ViewData["Title"] = Model.Title;
}

<div class="container mt-5">
    <!-- HÀNG ẢNH -->
    <div class="row">
        <div class="col-md-8 mb-4">
            @if (Model.Images != null && Model.Images.Any())
            {
                <div class="main-image mb-3 position-relative rounded overflow-hidden shadow-sm">
                    <img id="mainImage" src="@Model.Images.First().ImageUrl"
                         alt="@Model.Title"
                         class="img-fluid w-100"
                         style="height: 450px; object-fit: cover;">
                    <button id="prevBtn" class="nav-btn left"><i class="bi bi-chevron-left"></i></button>
                    <button id="nextBtn" class="nav-btn right"><i class="bi bi-chevron-right"></i></button>
                </div>

                <div class="thumbnail-gallery d-flex flex-wrap gap-2">
                    @for (int i = 0; i < Model.Images.Count; i++)
                    {
                        var img = Model.Images.ElementAt(i);
                        <img src="@img.ImageUrl"
                             class="thumbnail-img rounded shadow-sm"
                             data-index="@i"
                             style="width:90px; height:80px; object-fit:cover; cursor:pointer;" />
                    }
                </div>
            }
            else
            {
                <img src="/images/no-image.png"
                     class="img-fluid rounded shadow-sm"
                     style="height:400px; object-fit:cover;" />
            }
        </div>

        <!-- THÔNG TIN CHI TIẾT -->
        <div class="col-md-4">
            <div class="card border-0 shadow-sm rounded-3 p-4 sticky-top" style="top: 90px;">
                <h3 class="fw-bold text-primary mb-3">@Model.Title</h3>

                <div class="text-muted mb-3 small">
                    <i class="bi bi-calendar"></i> @Model.CreateAt.ToString("dd/MM/yyyy")
                    <span class="ms-3"><i class="bi bi-eye"></i> @Model.ClickCount lượt xem</span>
                </div>

                <div class="mb-3">
                    <span class="badge bg-success fs-6">@Model.Status</span>
                </div>

                <ul class="list-unstyled mb-4">
                    <li class="mb-2"><i class="bi bi-geo-alt text-danger"></i> <b>Địa chỉ:</b> @Model.Location</li>
                    <li class="mb-2">
                        <i class="bi bi-cash-stack text-success"></i>
                        <b>Giá:</b> @(Model.Price?.ToString("N0") ?? "Thỏa thuận") VNĐ
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-rulers text-primary"></i>
                        <b>Diện tích:</b> @(Model.Area ?? 0) m²
                    </li>
                </ul>

                <a asp-action="Index" class="btn btn-outline-secondary w-100 rounded-pill">
                    <i class="bi bi-arrow-left"></i> Quay lại
                </a>
            </div>
        </div>
    </div>

    <!-- MÔ TẢ -->
    <div class="mt-5">
        <h4 class="fw-semibold mb-3 text-dark border-start border-4 border-primary ps-2">📝 Mô tả chi tiết</h4>
        <div class="bg-light p-4 rounded shadow-sm" style="line-height:1.7;">
            @Html.Raw(Model.Description?.Replace("\n", "<br>"))
        </div>
    </div>
</div>

<!-- STYLE -->
<style>
    .main-image img {
        transition: transform 0.3s ease;
    }

    .main-image:hover img {
        transform: scale(1.02);
    }

    .nav-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.4);
        border: none;
        color: white;
        font-size: 1.5rem;
        padding: 8px 12px;
        border-radius: 50%;
        cursor: pointer;
        transition: background 0.2s ease;
    }

    .nav-btn:hover {
        background: rgba(0, 0, 0, 0.7);
    }

    .nav-btn.left {
        left: 10px;
    }

    .nav-btn.right {
        right: 10px;
    }

    .thumbnail-img {
        transition: transform 0.2s ease, border 0.2s ease;
        border: 2px solid transparent;
    }

    .thumbnail-img:hover {
        transform: scale(1.05);
        border-color: #0d6efd;
    }

    .thumbnail-img.active-thumb {
        border-color: #0d6efd;
        box-shadow: 0 0 6px rgba(13, 110, 253, 0.5);
    }

    .thumbnail-gallery {
        overflow-x: auto;
        padding-bottom: 5px;
    }

    .sticky-top {
        z-index: 10;
    }

    @@media (max-width: 767px) {
        .main-image img {
            height: 300px !important;
        }
    }
</style>

@section Scripts {
    <script>
        let currentIndex = 0;
        const images = Array.from(document.querySelectorAll(".thumbnail-img"));
        const mainImage = document.getElementById("mainImage");

        function updateMainImage(index) {
            if (index < 0 || index >= images.length) return;
            currentIndex = index;
            mainImage.src = images[index].src;
            images.forEach(img => img.classList.remove("active-thumb"));
            images[index].classList.add("active-thumb");
        }

        // thumbnail click
        images.forEach((img, idx) => {
            img.addEventListener("click", () => updateMainImage(idx));
        });

        // next/prev buttons
        document.getElementById("prevBtn")?.addEventListener("click", () => {
            updateMainImage((currentIndex - 1 + images.length) % images.length);
        });

        document.getElementById("nextBtn")?.addEventListener("click", () => {
            updateMainImage((currentIndex + 1) % images.length);
        });

        // khởi tạo ảnh đầu tiên
        if (images.length > 0) {
            updateMainImage(0);
        }
    </script>
}
