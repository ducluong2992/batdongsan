@model IEnumerable<bds.Models.Post>

@{
    ViewData["Title"] = "Quản lý tin của tôi";
    var approved = Model.Where(p => p.Status == "Đã duyệt");
    var pending = Model.Where(p => p.Status == "Chờ duyệt");
    var rejected = Model.Where(p => p.Status == "Không duyệt");
    var expired = Model.Where(p => p.Status == "Hết hạn");
}

<div class="container mt-5 mb-5">
    <h2 class="text-center fw-bold text-primary mb-4">
        <i class="bi bi-journal-text"></i> Quản lý tin của tôi
    </h2>

    <!-- Tabs -->
    <ul class="nav nav-tabs justify-content-center fw-semibold border-0 mb-4" id="myPostTabs" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button" role="tab">
                ✅ Đã duyệt (@approved.Count())
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab">
                ⏳ Chờ duyệt (@pending.Count())
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="rejected-tab" data-bs-toggle="tab" data-bs-target="#rejected" type="button" role="tab">
                ❌ Bị từ chối (@rejected.Count())
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="expired-tab" data-bs-toggle="tab" data-bs-target="#expired" type="button" role="tab">
                ⏰ Hết hạn (@expired.Count())
            </button>
        </li>
    </ul>

    <div class="tab-content" id="myPostTabContent">

        <!-- ✅ ĐÃ DUYỆT -->
        <div class="tab-pane fade show active" id="approved" role="tabpanel">
            @if (!approved.Any())
            {
                <p class="text-muted text-center mt-4">Bạn chưa có bài đăng nào được duyệt.</p>
            }
            else
            {
                <div class="row g-4">
                    @foreach (var post in approved)
                    {
                        <div class="col-lg-4 col-md-6 col-sm-12">
                            <div class="card border-0 shadow-sm rounded-4 h-100 position-relative post-card">
                                <a asp-action="Details" asp-route-id="@post.PostID">
                                    <img src="@(post.Images?.FirstOrDefault()?.ImageUrl ?? "/images/no-image.png")"
                                         class="card-img-top rounded-top-4"
                                         style="height:220px;object-fit:cover;transition:0.3s;" />
                                </a>

                                <div class="card-body">
                                    <h5 class="fw-bold text-truncate mb-1">
                                        <a asp-action="Details" asp-route-id="@post.PostID"
                                           class="text-dark text-decoration-none hover-link">
                                            @post.Title
                                        </a>
                                    </h5>
                                    <p class="text-muted small mb-1">📍 @post.Location</p>
                                    <p class="text-danger fw-semibold mb-1">
                                        💰 @(post.Price.HasValue ? string.Format("{0:N0} ₫", post.Price) : "Thỏa thuận")
                                    </p>
                                    <p class="text-muted small mb-3">🕓 @post.CreateAt.ToString("dd/MM/yyyy")</p>

                                    <div class="d-flex justify-content-between">
                                        <a asp-action="Edit" asp-route-id="@post.PostID"
                                           class="btn btn-sm btn-outline-warning rounded-pill">Sửa</a>
                                        <a asp-action="Delete" asp-route-id="@post.PostID"
                                           class="btn btn-sm btn-outline-danger rounded-pill"
                                           onclick="return confirm('Bạn chắc chắn muốn xóa?')">Xóa</a>
                                    </div>
                                </div>
                                <span class="badge bg-success position-absolute top-0 start-0 m-2 shadow">Đã duyệt</span>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>

        <!-- ⏳ CHỜ DUYỆT -->
        <div class="tab-pane fade" id="pending" role="tabpanel">
            @if (!pending.Any())
            {
                <p class="text-muted text-center mt-4">Bạn chưa có bài nào đang chờ duyệt.</p>
            }
            else
            {
                <div class="row g-4">
                    @foreach (var post in pending)
                    {
                        <div class="col-lg-4 col-md-6 col-sm-12">
                            <div class="card border-0 shadow-sm rounded-4 h-100 position-relative post-card">
                                <img src="@(post.Images?.FirstOrDefault()?.ImageUrl ?? "/images/no-image.png")"
                                     class="card-img-top rounded-top-4"
                                     style="height:220px;object-fit:cover;opacity:0.9;" />

                                <div class="card-body">
                                    <h5 class="fw-bold text-truncate mb-1 text-secondary">@post.Title</h5>
                                    <p class="text-muted small mb-1">📍 @post.Location</p>
                                    <p class="text-danger fw-semibold mb-1">
                                        💰 @(post.Price.HasValue ? string.Format("{0:N0} ₫", post.Price) : "Thỏa thuận")
                                    </p>
                                    <p class="text-muted small mb-3">🕓 @post.CreateAt.ToString("dd/MM/yyyy")</p>

                                    <div class="d-flex justify-content-between">
                                        <a asp-action="Edit" asp-route-id="@post.PostID"
                                           class="btn btn-sm btn-outline-warning rounded-pill">Sửa</a>
                                        <a asp-action="Delete" asp-route-id="@post.PostID"
                                           class="btn btn-sm btn-outline-danger rounded-pill"
                                           onclick="return confirm('Bạn chắc chắn muốn xóa?')">Xóa</a>
                                    </div>
                                </div>

                                <span class="badge bg-warning text-dark position-absolute top-0 start-0 m-2 shadow">Chờ duyệt</span>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>

        <!-- ❌ BỊ TỪ CHỐI -->
        <div class="tab-pane fade" id="rejected" role="tabpanel">
            @if (!rejected.Any())
            {
                <p class="text-muted text-center mt-4">Không có bài nào bị từ chối.</p>
            }
            else
            {
                <div class="row g-4">
                    @foreach (var post in rejected)
                    {
                        <div class="col-lg-4 col-md-6 col-sm-12">
                            <div class="card border-0 shadow-sm rounded-4 h-100 position-relative post-card">
                                <img src="@(post.Images?.FirstOrDefault()?.ImageUrl ?? "/images/no-image.png")"
                                     class="card-img-top rounded-top-4"
                                     style="height:220px;object-fit:cover;opacity:0.9;" />
                                <div class="card-body">
                                    <h5 class="fw-bold text-truncate mb-1 text-secondary">@post.Title</h5>
                                    <p class="text-danger small mb-2">❗ Lý do: @post.RejectReason</p>
                                    <p class="text-muted small mb-3">🕓 @post.CreateAt.ToString("dd/MM/yyyy")</p>
                                </div>
                                <span class="badge bg-danger position-absolute top-0 start-0 m-2 shadow">Từ chối</span>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>

        <!-- ⏰ HẾT HẠN -->
        <div class="tab-pane fade" id="expired" role="tabpanel">
            @if (!expired.Any())
            {
                <p class="text-muted text-center mt-4">Không có bài nào đã hết hạn.</p>
            }
            else
            {
                <div class="row g-4">
                    @foreach (var post in expired)
                    {
                        <div class="col-lg-4 col-md-6 col-sm-12">
                            <div class="card border-0 shadow-sm rounded-4 h-100 position-relative post-card opacity-75">
                                <img src="@(post.Images?.FirstOrDefault()?.ImageUrl ?? "/images/no-image.png")"
                                     class="card-img-top rounded-top-4 grayscale"
                                     style="height:220px;object-fit:cover;opacity:0.8;" />
                                <div class="card-body">
                                    <h5 class="fw-bold text-truncate mb-1 text-secondary">@post.Title</h5>
                                    <p class="text-muted small mb-3">🕓 @post.CreateAt.ToString("dd/MM/yyyy")</p>
                                </div>
                                <span class="badge bg-secondary position-absolute top-0 start-0 m-2 shadow">Hết hạn</span>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    </div>
</div>

<style>
    .nav-tabs .nav-link {
        color: #0d6efd;
        border: none;
        margin: 0 6px;
        border-radius: 10px 10px 0 0;
        background-color: #f8f9fa;
        transition: all 0.2s ease;
    }

        .nav-tabs .nav-link.active {
            background-color: #0d6efd;
            color: #fff;
            box-shadow: 0 4px 10px rgba(13, 110, 253, 0.2);
        }

    .post-card {
        transition: transform 0.25s ease, box-shadow 0.25s ease;
    }

        .post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.12);
        }

    .hover-link:hover {
        color: #0d6efd !important;
        text-decoration: underline;
    }

    .grayscale {
        filter: grayscale(100%);
    }
</style>
