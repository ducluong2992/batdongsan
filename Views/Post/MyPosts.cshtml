@model IEnumerable<bds.Models.Post>

@{
    ViewData["Title"] = "Quản lý tin của tôi";
    var approved = Model.Where(p => p.Status == "Đã duyệt");
    var pending = Model.Where(p => p.Status == "Chờ duyệt");
    var rejected = Model.Where(p => p.Status == "Bị từ chối");
}

<div class="container mt-4">
    <h2 class="mb-3 text-center">Quản lý tin của tôi</h2>

    <ul class="nav nav-tabs" id="myPostTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button" role="tab">
                Đã duyệt
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab">
                Chờ duyệt
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="rejected-tab" data-bs-toggle="tab" data-bs-target="#rejected" type="button" role="tab">
                Bị từ chối
            </button>
        </li>
    </ul>

    <div class="tab-content mt-3" id="myPostTabContent">
        <!-- Đã duyệt -->
        <div class="tab-pane fade show active" id="approved" role="tabpanel">
            @if (!approved.Any())
            {
                <p class="text-muted text-center mt-3">Bạn chưa có bài đăng nào được duyệt.</p>
            }
            else
            {
                <table class="table table-striped align-middle">
                    <thead>
                        <tr>
                            <th>Ảnh</th>
                            <th>Tiêu đề</th>
                            <th>Giá</th>
                            <th>Diện tích</th>
                            <th>Ngày đăng</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var post in approved)
                        {
                            <tr>
                                <td><img src="@(post.Images?.FirstOrDefault()?.ImageUrl ?? "/images/no-image.png")" width="100" /></td>
                                <td>@post.Title</td>
                                <td>@String.Format("{0:N0} ₫", post.Price)</td>
                                <td>@post.Area m²</td>
                                <td>@post.CreateAt.ToString("dd/MM/yyyy")</td>
                                <td>
                                    <a asp-action="Details" asp-route-id="@post.PostID" class="btn btn-sm btn-primary">Xem</a>
                                    <a asp-action="Edit" asp-route-id="@post.PostID" class="btn btn-sm btn-warning">Sửa</a>
                                    <a asp-action="Delete" asp-route-id="@post.PostID" class="btn btn-sm btn-danger" onclick="return confirm('Bạn chắc chắn muốn xóa?')">Xóa</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>

        <!-- Chờ duyệt -->
        <div class="tab-pane fade" id="pending" role="tabpanel">
            @if (!pending.Any())
            {
                <p class="text-muted text-center mt-3">Hiện bạn chưa có bài nào đang chờ duyệt.</p>
            }
            else
            {
                <table class="table table-striped align-middle">
                    <thead>
                        <tr>
                            <th>Ảnh</th>
                            <th>Tiêu đề</th>
                            <th>Giá</th>
                            <th>Ngày đăng</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var post in pending)
                        {
                            <tr>
                                <td><img src="@(post.Images?.FirstOrDefault()?.ImageUrl ?? "/images/no-image.png")" width="100" /></td>
                                <td>@post.Title</td>
                                <td>@String.Format("{0:N0} ₫", post.Price)</td>
                                <td>@post.CreateAt.ToString("dd/MM/yyyy")</td>
                                <td>
                                    <a asp-action="Edit" asp-route-id="@post.PostID" class="btn btn-sm btn-warning">Sửa</a>
                                    <a asp-action="Delete" asp-route-id="@post.PostID" class="btn btn-sm btn-danger" onclick="return confirm('Bạn chắc chắn muốn xóa?')">Xóa</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>

        <!-- Bị từ chối -->
        <div class="tab-pane fade" id="rejected" role="tabpanel">
            @if (!rejected.Any())
            {
                <p class="text-muted text-center mt-3">Không có bài nào bị từ chối.</p>
            }
            else
            {
                <table class="table table-striped align-middle">
                    <thead>
                        <tr>
                            <th>Ảnh</th>
                            <th>Tiêu đề</th>
                            <th>Lý do bị từ chối</th>
                            <th>Ngày đăng</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var post in rejected)
                        {
                            <tr>
                                <td><img src="@(post.Images?.FirstOrDefault()?.ImageUrl ?? "/images/no-image.png")" width="100" /></td>
                                <td>@post.Title</td>
                                <td class="text-danger">@post.RejectReason</td>
                                <td>@post.CreateAt.ToString("dd/MM/yyyy")</td>
                                <td>
                                    <a asp-action="Edit" asp-route-id="@post.PostID" class="btn btn-sm btn-secondary">Sửa lại</a>
                                    <a asp-action="Delete" asp-route-id="@post.PostID" class="btn btn-sm btn-danger" onclick="return confirm('Bạn chắc chắn muốn xóa?')">Xóa</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>
    </div>
</div>
